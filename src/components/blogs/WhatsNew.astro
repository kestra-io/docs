---
import Image from "astro/components/Image.astro"
import { getCollection } from "astro:content"

const blogs = await getCollection("blogs")

const recentBlogs = await Promise.all(
    blogs
        .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
        .slice(0, 4)
        .map(async (blog) => ({
            path: `/blogs/${blog.id}`,
            ...blog.data,
            image: blog.data.image,
        })),
)

const dateTimeFormat = new Intl.DateTimeFormat("en-US", {
    dateStyle: "long",
})
---

<div>
    <h2>What's New in Kestra</h2>
    <div class="list-of-posts">
        {
            recentBlogs.map((post, index) => (
                <div>
                    {index == 0 ? "" : <hr />}
                    <a href={post.path} class="post-card">
                        <Image
                            src={post.image}
                            class="card-img-left"
                            alt={post.title}
                            width={80}
                        />
                        <div class="card-body">
                            <div class="card-details">
                                <span class="card-category">
                                    {post.category}
                                </span>
                                <span class="card-date">
                                    {dateTimeFormat.format(new Date(post.date))}
                                </span>
                            </div>
                            <p class="card-title">{post.title}</p>
                        </div>
                    </a>
                </div>
            ))
        }
    </div>
</div>

<style lang="scss" scoped>
    @import "~/assets/styles/variable";
    h2 {
        font-size: $font-size-xl;
        margin-top: 3rem;
        margin-bottom: 1rem;
        padding: 0;
        font-weight: 600;
    }
    .list-of-posts hr {
        width: 100%;
        border: none;
        border-top: 1px solid $black-3;
        margin: 0;
    }

    .post-card {
        display: flex;
        gap: 1rem;
        align-items: start;
        padding: 0.5rem 0;
        &:hover {
            background-image: radial-gradient(
                circle,
                rgba($primary, 0.3) 0%,
                #13172500 30%
            );
            background-position: -280px center;
            background-repeat: no-repeat;
        }
    }

    .card-img-left {
        width: 125px;
        height: 70px;
        object-fit: cover;
        border-radius: 0.25rem;
        border: 1px solid $black-3;
    }
    .card-body {
        display: flex;
        flex-direction: column;
    }
    .card-details {
        font-size: $font-size-xs;
    }
    .card-category {
        color: $purple-36;
        margin-right: 1rem;
    }
    .card-date {
        color: $white-3;
    }
    .card-title {
        font-size: $font-size-sm;
        font-weight: normal;
    }
</style>
