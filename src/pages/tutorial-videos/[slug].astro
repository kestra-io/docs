---
export const prerender = false;
import Layout from '../../components/layout.astro';
import VideosTutorialsList from '~/components/videos/TutorialsList.vue'
import CommonPagination from '~/components/common/Pagination.vue'
import { $fetch } from '~/utils/fetch';

const tags = new Map([
  ['all', 'All videos'],
  ['deep-dive', 'Deep Dive Tutorials'],
  ['quick-start', 'Quick Start Tutorials'],
  ['feature-highlight', 'Feature Highlight']
])

const { slug } = Astro.params;

const currentCategory = slug ? tags.get(slug) ?? '' : '';

const PageURL = new URL(Astro.request.url);

const itemsPerPageStr = PageURL.searchParams.get('size')
const itemsPerPage = itemsPerPageStr ? parseInt(itemsPerPageStr) : 24;

const pageStr = PageURL.searchParams.get('page')
const page = pageStr ? parseInt(pageStr) : 1;

const currentCategoryFilter = slug === 'all' ? '' : currentCategory;

const API_URL = `https://api.kestra.io/v1/tutorial-videos?page=${page}&size=${itemsPerPage}&category=${currentCategoryFilter}`;

const tutorialVideo = await $fetch(API_URL);
---

<Layout>
    <VideosTutorialsList {...{tutorialVideo, page, itemsPerPage, currentCategory}} client:idle>
        <CommonPagination
            currentUrl={Astro.request.url}
            slot="pagination"
            currentPage={page}
            totalPages={Math.ceil(tutorialVideo.total/itemsPerPage)}
        />
    </VideosTutorialsList>
</Layout>
