---
// use astro content collection to fetch markdown files from /content/docs
import { render, getCollection, type CollectionEntry } from "astro:content";
import LayoutBlogs from "../../components/layout-blogs.astro";
import BlogDetails from "../../../components/blogs/BlogDetails.vue";
import NavToc from "../../../components/docs/NavToc.vue";
import Updateletter from "../../../components/layout/Updateletter.vue";

export async function getStaticPaths() {
	const blogsPages = await getCollection('blogs');
	return blogsPages.map((post) => ({
		params: { slug: post.id },
		props: post,
	}));
}

type Props = CollectionEntry<'blogs'>;
const post = Astro.props;
const { Content, headings } = await render(post);
const page = post.data

const links = headings.map(h => ({
                text: h.text,
                id: h.slug,
                depth: h.depth
            }))

const {title, description, image, date, authors} = page

const jsonLinkedData = {
            "@context" : "http://schema.org",
            "@type" : "BlogPosting",
            "mainEntityofPage" : {
                "@type" : "Webpage",
                "@id" : `/blogs/${post.id}`,
            },
            "headline": title,
            "image": [image ],
            "datePublished": date,
            "author": (authors ?? []).map(author => ({ "@type": "Person", "name": author.name })),
            "publisher": { "@type": "Organization", "name": "Kestra", "logo": { "@type": "ImageObject", "url": "https://kestra.io/logo.svg" } },
            "description": description,
        }
---
<LayoutBlogs activeStem={`/blogs/${post.id}`} title={title} description={description}>
    <Fragment slot="head">
        <meta name="title" content={title} />
        <meta name="description" content={description} />
        <meta property="og:title" content={title} />
        <meta property="og:description" content={description} />
        <meta property="og:image" content={image} />
        <meta property="og:type" content="article" />
        <meta property="article:published_time" content={new Date(date).toISOString()} />
        <meta property="twitter:title" content={title} />
        <meta property="twitter:description" content={description} />
        <meta property="twitter:image" content={image} />
        <script type="application/ld+json" set:html={JSON.stringify(jsonLinkedData)}/>
    </Fragment>
    <div class="container bd-gutter bd-layout margin">
        {post && (
        <article
            class="bd-main order-1"
            class:list={[{ full: page.rightBar === false }]}
        >
            <div class="bd-content">
            <div class="bd-title">
                <p class="d-flex breadcrumb" data-aos="fade-right">
                    <a href="/">Home</a>/<a href="/blogs">Blog</a>
                </p>
                <h2 data-aos="fade-left" class="pt-0">
                {page.title}
                </h2>
                <BlogDetails blog={post} class="mt-3" />
                <div class="d-lg-none d-block" data-aos="fade-zoom">
                    <NavToc links={links} />
                </div>
            </div>
            <img
                loading="lazy"
                data-aos="fade-right"
                class="mb-2 rounded-3 img"
                alt={page.title}
                src={page.image}
            />
            <div class="subtitle">
                <p>{page.description}</p>
            </div>
                <Content/>
            </div>
            <NavToc links={links}/>
        </article>
        )}
    </div>
</LayoutBlogs>

<style>
    .breadcrumb a {
        margin: 0 0.2rem;
    }
</style>
