---
import Layout from "~/components/layout.astro"
import PluginsLists from "~/components/plugins/PluginsLists.vue"
import { $fetchApi } from "~/utils/fetch"
import type { Plugin } from "@kestra-io/ui-libs"
import { prunePlugins, pruneAllPluginsData } from "~/utils/plugins/pruning"

const plugins = await $fetchApi<Plugin[]>(`/plugins/subgroups`)
const pluginsData = await $fetchApi(`/plugins/pluginsInformation`)

const initialPlugins = prunePlugins(plugins.slice(0, 40))
const initialPluginsData = pruneAllPluginsData(pluginsData, initialPlugins.map(p => p.subGroup ?? p.group ?? p.name))

const title = "Hundreds of Plugins For All Your Orchestrations Needs"
const description = "Connect Kestra with tools you already know and love"
---

<Layout title={title} description={description}>
    <PluginsLists
        client:load
        pluginsData={initialPluginsData}
        plugins={initialPlugins}
        fullPath={Astro.request.url}
    />
</Layout>
