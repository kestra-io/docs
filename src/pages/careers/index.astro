---
import Layout from '../../components/layout.astro';
import CareersHeader from '~/components/careers/Header.vue';
import CareersPositionsRenderer from '~/components/careers/PositionsRenderer.vue';
import CareersPerks from '~/components/careers/Perks.vue';
import LayoutFooterContact from '~/components/layout/FooterContact.vue';
import { $fetch } from '~/utils/fetch';

const countryCodeToEmoji = (countryCode: string) => {
    let codePoints = countryCode.toUpperCase().split('').map(char =>  127397 + char.charCodeAt());
    return String.fromCodePoint(...codePoints);
}

const baseResponse = (job: any) => {
    return {
        id: job.id,
        title: job.title,
        locations: job.locations ? job.locations.map(l => {
            return l.location_option.display_name === "International" ?
                {
                    code: null,
                    name: "World",
                    emoji: "ðŸŒ"
                } : {
                code: l.location_option.country,
                name: l.location_option.display_name,
                emoji: countryCodeToEmoji(l.location_option.country)
            }
        }) : null,
        remote: job.locations ? job.locations.filter(l => l.location_type === 'REMOTE').length > 0 : null,
        link: `https://app.dover.com/apply/Kestra%20Technologies/${job.id}`,
    }
}

const jobsList = await $fetch(`https://app.dover.com/api/v1/careers-page/1fbbcad7-3e1b-4b61-96d4-f45f0b51c100/jobs?limit=300&offset=0`);

const positions = jobsList.results.map((job) => {
                return baseResponse(job);
            })

const title = "Join Us and Shape the Future of Data Orchestration";
const description = "Discover exciting career opportunities at Kestra. Join our passionate team and help us shape the future of data orchestration";
---

<Layout title={title} description={description}>
    <CareersHeader fullPath="/careers" />
    <CareersPositionsRenderer positions={positions} />
    <CareersPerks />
    <LayoutFooterContact
        title="Join our community"
        darkButtonText="Join our Slack"
        darkButtonHref="https://kestra.io/slack"
        purpleButtonText="Contribute"
        purpleButtonHref="/docs/plugin-developer-guide"
    />
</Layout>
